#!/usr/bin/env python

import pygtk
pygtk.require20()
import gtk

from twisted.internet import gtk2reactor
gtk2reactor.install()

from twisted.internet import reactor


class ConfigurationWindow(object):
    salt = None

    def initialize(self, ui_file):
        self.builder = gtk.Builder()
        self.builder.add_from_file(ui_file)

        signals = {'on_test_login_button_clicked': self._on_test_connection_button_clicked,
                   'on_register_button_clicked': self._on_register_button_clicked,
                   'on_test_connection_button_clicked': self._on_test_connection_button_clicked,
                   'on_cancel_button_clicked': lambda widget, *data: self.close(),
                   'on_ok_button_clicked': self._on_ok_button_clicked}

        self.builder.connect_signals(signals)

        self.window = self.builder.get_object('configuration')
        self.window.connect('destroy', lambda widget, *data: self.close())
        self.window.set_modal(True)

    def close(self):
        self.window.hide()
        self.window.destroy()

    def show(self):
        self.window.show()

    def _on_test_login_button_clicked(self, widget, *data):
        pass

    def _on_register_button_clicked(self, widget, *data):
        pass

    def _on_test_connection_button_clicked(self, widget, *data):
        pass

    def _on_ok_button_clicked(self, widget, *data):
        pass

    def _create_passwd_hash(self, passwd):
        from hashlib import sha256
        assert self.salt
        digest = sha256(self.salt + passwd)
        return digest.hexdigest()


class MainWindow(object):
    def initialize(self, ui_file):
        self.builder = gtk.Builder()
        self.builder.add_from_file(ui_file)

        signals = {'on_quit_mi_activate': gtk.main_quit,
                   'on_connect_mi_activate': lambda widget, *data: None,
                   'on_disconnect_mi_activate': lambda widget, *data: None,
                   'on_config_mi_activate': self._on_config_mi_activate,
                   'on_new_channel_mi_activate': lambda widget, *data: None,
                   'on_del_channel_mi_activate': lambda widget, *data: None,
                   'on_refresh_mi_activate': lambda widget, *data: None,
                   'on_about_mi_activate': lambda widget, *data: None}

        self.builder.connect_signals(signals)

        self.main_window = self.builder.get_object('main_window')
        self.main_window.connect('destroy', gtk.main_quit)

    def show(self):
        self.main_window.show_all()

    def _on_config_mi_activate(self, widget, *data):
        self.main_window.set_sensitive(False)
        try:
            window = ConfigurationWindow()
            window.initialize('ui/configuration.glade')
            window.show()
        finally:
            self.main_window.set_sensitive(True)

    def _on_connect_mi_activate(self, widget, *data):
        pass

    def _on_disconnect_mi_activate(self, widget, *data):
        pass

    def _on_new_channel_mi_activate(self, widget, *data):
        pass

    def _on_del_channel_mi_activate(self, widget, *data):
        pass

    def _on_refresh_mi_activate(self, widget, *data):
        pass

    def _on_about_mi_activate(self, widget, *data):
        pass


def main():
    main_window = MainWindow()
    main_window.initialize('ui/main.glade')
    main_window.show()

    reactor.run()

if __name__ == '__main__':
    main()
